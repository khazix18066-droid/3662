<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fukuoka Luxury Trip</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gold: {
                            100: '#F9F1D8',
                            300: '#E8D090',
                            500: '#D4AF37', // Classic Gold
                            600: '#AA8C2C',
                            900: '#5E4B10',
                        },
                        richblack: '#0F1115',
                        charcoal: '#1A1D23',
                    },
                    fontFamily: {
                        serif: ['"Playfair Display"', 'serif'],
                        sans: ['"Lato"', 'sans-serif'],
                    },
                    backgroundImage: {
                        'gradient-gold': 'linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #0F1115;
            color: #E2E8F0;
            font-family: 'Lato', sans-serif;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: 80px; /* Space for bottom nav */
        }
        h1, h2, h3, .font-serif {
            font-family: 'Playfair Display', serif;
        }
        .gold-text {
            background: linear-gradient(to right, #F9F1D8, #D4AF37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .card {
            background: #1A1D23;
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
        }
        .btn-gold {
            background: linear-gradient(135deg, #D4AF37 0%, #AA8C2C 100%);
            color: #0F1115;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: transform 0.1s;
        }
        .btn-gold:active {
            transform: scale(0.98);
        }
        /* Hide scrollbar for clean look */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }
        .nav-item.active {
            color: #D4AF37;
        }
        .nav-item.active i {
            transform: translateY(-5px);
            filter: drop-shadow(0 0 8px rgba(212, 175, 55, 0.6));
        }
        /* Input Styling */
        input, textarea, select {
            background-color: #0F1115 !important;
            border: 1px solid #333 !important;
            color: #F9F1D8 !important;
        }
        input:focus, textarea:focus {
            border-color: #D4AF37 !important;
            outline: none;
        }
    </style>
</head>
<body>

    <header class="p-6 text-center border-b border-white/10 sticky top-0 bg-richblack/90 z-40 backdrop-blur-md">
        <h1 class="text-2xl font-bold tracking-widest gold-text uppercase">Fukuoka Trip</h1>
        <p class="text-xs text-gray-400 tracking-wider mt-1">LUXURY EDITION</p>
    </header>

    <main id="app-container" class="p-4 max-w-md mx-auto relative">

        <section id="tab-plan" class="tab-content fade-in">
            <div class="card rounded-xl p-5 mb-6 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-gold-500/10 rounded-bl-full"></div>
                <h3 class="text-gold-500 text-sm uppercase tracking-widest mb-4 border-b border-white/10 pb-2">Flight Info</h3>
                <div class="flex justify-between items-center mb-3">
                    <div class="text-center">
                        <span class="block text-2xl font-serif font-bold text-white">TPE</span>
                        <span class="text-xs text-gray-500">å°åŒ—</span>
                    </div>
                    <div class="flex-1 text-center px-2">
                        <i class="fas fa-plane text-gold-500"></i>
                        <div class="h-[1px] bg-gold-500/30 w-full mt-1"></div>
                        <span class="text-[10px] text-gold-300">CI110 / CI129</span>
                    </div>
                    <div class="text-center">
                        <span class="block text-2xl font-serif font-bold text-white">FUK</span>
                        <span class="text-xs text-gray-500">ç¦å²¡</span>
                    </div>
                </div>
            </div>

            <div class="card rounded-xl p-5 mb-8 flex items-start space-x-4">
                <div class="bg-gold-500/20 p-3 rounded-full text-gold-500">
                    <i class="fas fa-hotel"></i>
                </div>
                <div>
                    <h3 class="text-white font-bold text-lg leading-tight">ç¦å²¡æ±æ€¥STAYé£¯åº—</h3>
                    <p class="text-xs text-gray-400 mt-1">Tokyu Stay Fukuoka Tenjin</p>
                    <a href="https://www.google.com/maps/search/?api=1&query=Tokyu+Stay+Fukuoka+Tenjin" target="_blank" class="inline-block mt-3 text-xs border border-gold-500 text-gold-500 px-3 py-1 rounded-full hover:bg-gold-500 hover:text-black transition">
                        <i class="fas fa-map-marker-alt mr-1"></i> å°èˆª
                    </a>
                </div>
            </div>

            <div class="space-y-8 pl-2">
                
                <div class="relative border-l border-gold-500/30 pl-6 pb-2">
                    <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gold-500 rounded-full shadow-[0_0_10px_#D4AF37]"></div>
                    <h2 class="text-xl font-serif text-gold-100 mb-1">Day 01 | æŠµé”èˆ‡æ”¾é¬†</h2>
                    <p class="text-sm text-gray-400 mb-4">å¸‚å€æ‚ é–’æ¢å¾©é«”åŠ›</p>
                    
                    <div class="card rounded-lg p-4 mb-3">
                        <div class="flex justify-between items-start">
                            <h4 class="font-bold text-white">ç¦å²¡æ©Ÿå ´ -> é£¯åº—</h4>
                            <span class="text-xs bg-gray-700 px-2 py-1 rounded text-gray-300">Check-in</span>
                        </div>
                    </div>
                    
                    <div class="card rounded-lg p-4">
                        <h4 class="font-bold text-white mb-2">å¤©ç¥/åšå¤šå¸‚å€æ•£ç­–</h4>
                        <p class="text-xs text-gray-400 mb-3">å»ºè­°å‰å¾€å±‹å°è¡—é«”é©—ç•¶åœ°ç¾é£Ÿï¼Œæˆ–åœ¨é‹æ²³åŸé€›è¡—ã€‚</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=Fukuoka+Yatai" target="_blank" class="text-xs text-gold-400 underline">æŸ¥çœ‹å±‹å°ä½ç½®</a>
                    </div>
                </div>

                <div class="relative border-l border-gold-500/30 pl-6 pb-2">
                    <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gold-500 rounded-full shadow-[0_0_10px_#D4AF37]"></div>
                    <h2 class="text-xl font-serif text-gold-100 mb-1">Day 02 | å¾©å¤èˆ‡å¤œæ™¯</h2>
                    <p class="text-sm text-gray-400 mb-4">é–€å¸æ¸¯ãƒ»çš¿å€‰å±±ãƒ»å°å€‰åŸ</p>

                    <div class="card rounded-lg p-4 mb-3 border-l-4 border-gold-500">
                        <h4 class="font-bold text-white">ğŸš‚ é–€å¸æ¸¯æ‡·èˆŠå€</h4>
                        <p class="text-xs text-gray-400 mt-1">å¿…åƒï¼šç‡’å’–å“©</p>
                    </div>

                    <div class="card rounded-lg p-4 mb-3">
                        <h4 class="font-bold text-white">ğŸ¯ å°å€‰åŸ</h4>
                    </div>

                    <div class="card rounded-lg p-4 mb-3 bg-gray-800/80">
                        <div class="flex items-center text-gold-400 mb-2">
                            <i class="fas fa-star mr-2"></i>
                            <span class="text-xs font-bold uppercase">Highlight</span>
                        </div>
                        <h4 class="font-bold text-white">ğŸŒƒ çš¿å€‰å±±ç™¾å„„å¤œæ™¯</h4>
                        <p class="text-xs text-gray-400 mt-1">è¨˜å¾—æŸ¥å¥½çºœè»Šæœ«ç­æ™‚é–“ã€‚</p>
                    </div>
                </div>

                <div class="relative border-l border-gold-500/30 pl-6 pb-2">
                    <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gold-500 rounded-full"></div>
                    <h2 class="text-xl font-serif text-gold-100 mb-1">Day 03 | æ–‡åŒ–èˆ‡æ°´é„‰</h2>
                    <p class="text-sm text-gray-400 mb-4">å¤ªå®°åºœãƒ»æŸ³å·éŠèˆ¹</p>

                    <div class="card rounded-lg p-4 mb-3">
                        <h4 class="font-bold text-white">â›©ï¸ å¤ªå®°åºœå¤©æ»¿å®®</h4>
                        <p class="text-xs text-gray-400 mt-1">å¿…åƒï¼šæ¢…æé¤…ã€‚æ¬£è³éšˆç ”å¾è¨­è¨ˆçš„æ˜Ÿå·´å…‹ã€‚</p>
                    </div>
                    <div class="card rounded-lg p-4">
                        <h4 class="font-bold text-white">ğŸš£ æŸ³å·éŠèˆ¹</h4>
                        <p class="text-xs text-gray-400 mt-1">åˆé¤æ¨è–¦ï¼šæœ¬å‰å±‹é°»é­šé£¯ã€‚</p>
                    </div>
                </div>

                 <div class="relative border-l border-gold-500/30 pl-6 pb-2">
                    <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gold-500 rounded-full"></div>
                    <h2 class="text-xl font-serif text-gold-100 mb-1">Day 04 | è³¼ç‰©èˆ‡ä¼‘é–’</h2>
                    <p class="text-sm text-gray-400 mb-4">LaLaportãƒ»å¤§æ¿ å…¬åœ’</p>

                    <div class="card rounded-lg p-4 mb-3">
                        <h4 class="font-bold text-white">ğŸ›ï¸ LaLaport ç¦å²¡</h4>
                        <p class="text-xs text-gray-400 mt-1">çœ‹ 1:1 é‹¼å½ˆç«‹åƒï¼Œæœ€å¾Œæ¡è³¼ã€‚</p>
                    </div>
                    <div class="card rounded-lg p-4">
                        <h4 class="font-bold text-white">ğŸŒ³ å¤§æ¿ å…¬åœ’</h4>
                        <p class="text-xs text-gray-400 mt-1">åœ¨æ¹–é‚Šå’–å•¡å»³äº«å—æœ€å¾Œçš„æ‚ é–’åˆå¾Œã€‚</p>
                    </div>
                </div>

                <div class="relative border-l border-transparent pl-6 pb-2">
                    <div class="absolute -left-1.5 top-0 w-3 h-3 bg-gray-500 rounded-full"></div>
                    <h2 class="text-xl font-serif text-gold-100 mb-1">Day 05 | è¿”ç¨‹</h2>
                    <div class="card rounded-lg p-4 mt-4 bg-red-900/20 border-red-900/50">
                        <h4 class="font-bold text-red-200">âœˆï¸ å‰å¾€æ©Ÿå ´ (CI129)</h4>
                        <p class="text-xs text-red-200/70 mt-1">è«‹é ç•™ 3 å°æ™‚æŠµé”æ©Ÿå ´è¾¦ç†ç™»æ©Ÿã€‚</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="tab-guide" class="tab-content hidden fade-in">
            <h2 class="text-3xl font-serif text-gold-500 mb-6 border-b border-gray-700 pb-2">Guide Book</h2>
            
            <article class="mb-10">
                <h3 class="text-xl font-bold text-white mb-2">é–€å¸æ¸¯ Retro</h3>
                <p class="text-sm text-gray-400 leading-relaxed text-justify mb-4">
                    <span class="text-3xl float-left mr-2 mt-[-5px] font-serif text-gold-500">æ›¾</span>ç¶“æ˜¯æ—¥æœ¬ä¸‰å¤§æ¸¯å£ä¹‹ä¸€ï¼Œé–€å¸æ¸¯ä¿ç•™äº†è¨±å¤šå¤§æ­£æ™‚æœŸçš„æ´‹å¼å»ºç¯‰ã€‚é€™è£¡çš„æ°›åœå„ªé›…è€Œæ‡·èˆŠï¼Œå½·å½¿æ™‚é–“å‡çµåœ¨ç™¾å¹´å‰ã€‚æ¨è–¦åœ¨å¤•é™½è¥¿ä¸‹æ™‚æ•£æ­¥æ–¼æ¸¯é‚Šï¼Œæ¬£è³é—œé–€æµ·å³½çš„æ™¯è‰²ã€‚
                </p>
                <div class="bg-gray-800 p-3 rounded text-xs text-gold-300 italic border-l-2 border-gold-500">
                    ğŸ’¡ å†·çŸ¥è­˜ï¼šé–€å¸æ¸¯è»Šç«™æ˜¯æ—¥æœ¬å”¯ä¸€è¢«åˆ—ç‚ºåœ‹å®¶é‡è¦æ–‡åŒ–è²¡çš„è»Šç«™å»ºç¯‰ï¼Œè¨˜å¾—å»äºŒæ¨“çš„èˆŠè²´è³“å®¤çœ‹çœ‹ã€‚
                </div>
            </article>

             <div class="card p-2 rounded-xl mb-10">
                <h4 class="text-sm font-bold text-center mb-2 text-gray-300">LaLaport Gundam Park</h4>
                <div class="w-full h-48 bg-gray-700 rounded overflow-hidden">
                    <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://www.openstreetmap.org/export/embed.html?bbox=130.4190%2C33.5500%2C130.4250%2C33.5560&amp;layer=mapnik&amp;marker=33.5530%2C130.4220" style="border: 0"></iframe>
                </div>
                <div class="text-center mt-2">
                    <a href="https://www.google.com/maps/search/?api=1&query=LaLaport+Fukuoka" class="text-xs text-gold-500 underline">åœ¨ Google Maps é–‹å•Ÿ</a>
                </div>
            </div>

            <article class="mb-10">
                <h3 class="text-xl font-bold text-white mb-2">å¤ªå®°åºœå¤©æ»¿å®®</h3>
                <p class="text-sm text-gray-400 leading-relaxed text-justify">
                    ä¾›å¥‰ã€Œå­¸å•ä¹‹ç¥ã€è…åŸé“çœŸã€‚åƒé“ä¸Šç†±é¨°é¨°çš„ã€Œæ¢…æé¤…ã€æ˜¯å¿…åšç¾é£Ÿï¼Œå‚³èªªèƒ½é™¤ç—…ä¿å¹³å®‰ã€‚é€™è£¡ä¹Ÿæ˜¯è³æ¢…åæ‰€ï¼Œæ¯å¹´2æœˆè‡³3æœˆï¼Œ6000å¤šæ ªæ¢…èŠ±ç«¶ç›¸ç¶»æ”¾ã€‚
                </p>
            </article>
        </section>

        <section id="tab-wallet" class="tab-content hidden fade-in">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-serif text-gold-500">Wallet</h2>
                <div class="flex items-center space-x-2">
                    <span class="text-xs text-gray-400">åŒ¯ç‡: 0.</span>
                    <input type="number" id="exchange-rate" value="22" class="w-12 text-center text-xs p-1 rounded bg-gray-800 border border-gray-600 focus:border-gold-500 text-white" onchange="saveRate()">
                </div>
            </div>

            <div class="card p-5 rounded-xl mb-6 sticky top-20 z-30">
                <div class="grid grid-cols-3 gap-3 mb-3">
                    <div class="col-span-2">
                        <label class="text-[10px] text-gray-400 uppercase">å“é …</label>
                        <input type="text" id="item-name" placeholder="ä¾‹å¦‚ï¼šæ‹‰éºµ" class="w-full p-2 rounded text-sm bg-gray-900 border border-gray-700 text-white">
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-400 uppercase">æ—¥å¹£ (å¯ç®—å¼)</label>
                        <input type="text" id="item-price" placeholder="1000+50" class="w-full p-2 rounded text-sm bg-gray-900 border border-gray-700 text-white font-mono" onblur="calculateInput(this)">
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="flex items-center justify-center w-full h-10 border border-dashed border-gray-600 rounded cursor-pointer hover:border-gold-500 transition bg-gray-900/50">
                        <div class="flex items-center space-x-2 text-gray-400">
                            <i class="fas fa-camera"></i>
                            <span class="text-xs">æ‹å¼µç…§ / ä¸Šå‚³æ”¶æ“š</span>
                        </div>
                        <input type="file" id="item-photo" accept="image/*" class="hidden" onchange="previewImage()">
                    </label>
                    <div id="preview-container" class="hidden mt-2 text-center">
                        <img id="photo-preview" class="h-20 mx-auto rounded border border-gold-500/30 object-cover">
                        <button onclick="clearImage()" class="text-xs text-red-400 mt-1 underline">ç§»é™¤ç…§ç‰‡</button>
                    </div>
                </div>

                <button onclick="addExpense()" class="btn-gold w-full py-3 rounded-lg shadow-lg font-bold tracking-wider">
                    è¨˜ä¸€ç­†
                </button>
            </div>

            <div class="flex justify-between items-end mb-4 px-2">
                <div>
                    <p class="text-xs text-gray-400">ç¸½æ”¯å‡º (TWD)</p>
                    <p id="total-twd" class="text-2xl font-serif text-white font-bold">NT$ 0</p>
                </div>
                <div class="text-right">
                    <p class="text-xs text-gray-400">ç¸½æ”¯å‡º (JPY)</p>
                    <p id="total-jpy" class="text-lg font-mono text-gold-300">Â¥ 0</p>
                </div>
            </div>

            <div id="expense-list" class="space-y-3 pb-20">
                <div class="text-center text-gray-600 text-sm mt-10">å°šç„¡è¨˜å¸³ç´€éŒ„</div>
            </div>
        </section>

        <section id="tab-lists" class="tab-content hidden fade-in">
            <h2 class="text-2xl font-serif text-gold-500 mb-4">Checklist</h2>
            
            <div class="card p-4 rounded-xl mb-6">
                <h3 class="text-sm font-bold text-white mb-3 border-b border-gray-700 pb-1">å¿…å‚™ç‰©å“</h3>
                <ul class="space-y-3" id="checklist-container">
                    </ul>
            </div>

            <h2 class="text-2xl font-serif text-gold-500 mb-4">Memo</h2>
            <div class="card p-4 rounded-xl">
                <textarea id="memo-area" class="w-full h-40 bg-transparent text-sm text-gray-300 border-none resize-none focus:ring-0 p-0 leading-relaxed" placeholder="åœ¨é€™è£¡è¼¸å…¥ç­†è¨˜æˆ–æ˜¯è²¼ä¸Šç¶²å€ï¼Œç³»çµ±æœƒè‡ªå‹•è½‰æ›ç¶²å€ç‚ºæŒ‰éˆ•..." oninput="saveMemo()"></textarea>
                <div id="memo-links" class="mt-4 flex flex-wrap gap-2">
                    </div>
            </div>
        </section>

        <section id="tab-info" class="tab-content hidden fade-in">
            <h2 class="text-2xl font-serif text-gold-500 mb-6">Information</h2>

            <div class="grid grid-cols-2 gap-4 mb-6">
                <a href="https://www.jma.go.jp/bosai/forecast/" target="_blank" class="card p-4 rounded-xl flex flex-col items-center justify-center aspect-square hover:bg-gray-800 transition">
                    <i class="fas fa-cloud-sun text-4xl text-blue-300 mb-2"></i>
                    <span class="text-sm font-bold">å¤©æ°£é å ±</span>
                </a>
                <a href="tel:119" class="card p-4 rounded-xl flex flex-col items-center justify-center aspect-square hover:bg-gray-800 transition border-red-900/30">
                    <i class="fas fa-ambulance text-4xl text-red-500 mb-2"></i>
                    <span class="text-sm font-bold text-red-400">ç·Šæ€¥ 119</span>
                </a>
            </div>

            <div class="card p-5 rounded-xl mb-4 border-l-4 border-red-500">
                <h3 class="font-bold text-white mb-2"><i class="fas fa-triangle-exclamation mr-2 text-red-500"></i>é‡è¦æé†’</h3>
                <ul class="list-disc list-inside text-sm text-gray-400 space-y-2">
                    <li>æ—¥æœ¬é›»å£“ç‚º 100Vï¼Œæ’åº§ç‚ºé›™å¹³è…³ï¼ˆèˆ‡å°ç£ç›¸åŒï¼‰ã€‚</li>
                    <li>è·¯ä¸Šç¦æ­¢å¸è¸ï¼Œè«‹è‡³æŒ‡å®šå¸è¸å€ã€‚</li>
                    <li>é›»è»Šå…§è«‹å°‡æ‰‹æ©Ÿè¨­ç‚ºéœéŸ³ï¼Œé¿å…é€šè©±ã€‚</li>
                    <li>å…¥å¢ƒæ—¥æœ¬è«‹å‹™å¿…å¡«å¯« <a href="https://vjw-lp.digital.go.jp/zh-hant/" target="_blank" class="text-gold-500 underline">Visit Japan Web</a>ã€‚</li>
                </ul>
            </div>

            <div class="card p-5 rounded-xl">
                 <h3 class="font-bold text-white mb-2">å°åŒ—é§å¤§é˜ªç¶“æ¿Ÿæ–‡åŒ–è¾¦äº‹è™•ç¦å²¡åˆ†è™•</h3>
                 <p class="text-xs text-gray-400">ç¦å²¡å¸‚ä¸­å¤®å€æ«»å‚ 3-12-42</p>
                 <a href="tel:+81-92-734-2810" class="btn-gold text-xs px-4 py-2 rounded mt-3 inline-block">æ’¥æ‰“é›»è©±</a>
            </div>
        </section>

    </main>

    <nav class="fixed bottom-0 left-0 w-full bg-richblack/95 backdrop-blur-lg border-t border-white/10 flex justify-around py-3 px-2 z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.5)]">
        <button onclick="switchTab('plan')" class="nav-item active flex flex-col items-center text-gray-500 w-1/5 transition-all duration-300" data-target="plan">
            <i class="fas fa-calendar-alt text-lg mb-1"></i>
            <span class="text-[10px] tracking-widest uppercase">Plan</span>
        </button>
        <button onclick="switchTab('guide')" class="nav-item flex flex-col items-center text-gray-500 w-1/5 transition-all duration-300" data-target="guide">
            <i class="fas fa-book-open text-lg mb-1"></i>
            <span class="text-[10px] tracking-widest uppercase">Guide</span>
        </button>
        <button onclick="switchTab('wallet')" class="nav-item flex flex-col items-center text-gray-500 w-1/5 transition-all duration-300" data-target="wallet">
            <i class="fas fa-wallet text-lg mb-1"></i>
            <span class="text-[10px] tracking-widest uppercase">Wallet</span>
        </button>
        <button onclick="switchTab('lists')" class="nav-item flex flex-col items-center text-gray-500 w-1/5 transition-all duration-300" data-target="lists">
            <i class="fas fa-list-check text-lg mb-1"></i>
            <span class="text-[10px] tracking-widest uppercase">Lists</span>
        </button>
        <button onclick="switchTab('info')" class="nav-item flex flex-col items-center text-gray-500 w-1/5 transition-all duration-300" data-target="info">
            <i class="fas fa-circle-info text-lg mb-1"></i>
            <span class="text-[10px] tracking-widest uppercase">Info</span>
        </button>
    </nav>

    <script>
        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            loadWallet();
            loadChecklist();
            loadMemo();
            loadRate();
        });

        // --- Navigation Logic ---
        function switchTab(tabId) {
            // Hide all sections
            document.querySelectorAll('.tab-content').forEach(el => {
                el.classList.add('hidden');
            });
            // Show target section
            document.getElementById(`tab-${tabId}`).classList.remove('hidden');
            
            // Update Nav Icons
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active', 'text-gold-500');
                el.classList.add('text-gray-500');
            });
            const activeBtn = document.querySelector(`button[data-target="${tabId}"]`);
            activeBtn.classList.add('active', 'text-gold-500');
            activeBtn.classList.remove('text-gray-500');
            
            window.scrollTo(0,0);
        }

        // --- Wallet Logic ---
        let currentImageBase64 = null;

        function loadRate() {
            const rate = localStorage.getItem('trip_rate') || 0.22;
            document.getElementById('exchange-rate').value = (rate * 100).toFixed(0);
        }

        function saveRate() {
            const val = document.getElementById('exchange-rate').value;
            localStorage.setItem('trip_rate', val / 100);
            renderExpenses(); // Re-calc totals
        }

        function calculateInput(input) {
            try {
                // Allow simple math (e.g. 500+200*2)
                if(input.value.match(/^[0-9+\-*/().\s]+$/)) {
                    input.value = eval(input.value);
                }
            } catch (e) {
                // Ignore errors
            }
        }

        function previewImage() {
            const file = document.getElementById('item-photo').files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                // Compress image using Canvas
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Resize to max 400px width
                    const maxWidth = 400;
                    const scale = maxWidth / img.width;
                    const width = maxWidth;
                    const height = img.height * scale;
                    
                    canvas.width = width;
                    canvas.height = height;
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Compress to JPEG 0.6
                    currentImageBase64 = canvas.toDataURL('image/jpeg', 0.6);
                    
                    document.getElementById('photo-preview').src = currentImageBase64;
                    document.getElementById('preview-container').classList.remove('hidden');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function clearImage() {
            document.getElementById('item-photo').value = "";
            document.getElementById('preview-container').classList.add('hidden');
            currentImageBase64 = null;
        }

        function addExpense() {
            const name = document.getElementById('item-name').value;
            const price = parseFloat(document.getElementById('item-price').value);
            
            if (!name || isNaN(price)) {
                alert("è«‹è¼¸å…¥æ­£ç¢ºçš„å“é …èˆ‡é‡‘é¡");
                return;
            }

            const expense = {
                id: Date.now(),
                name: name,
                price: price,
                img: currentImageBase64,
                date: new Date().toLocaleDateString()
            };

            let expenses = JSON.parse(localStorage.getItem('trip_expenses') || "[]");
            expenses.unshift(expense); // Add to top
            
            try {
                localStorage.setItem('trip_expenses', JSON.stringify(expenses));
            } catch (e) {
                alert("å„²å­˜å¤±æ•—ï¼å¯èƒ½æ˜¯ç…§ç‰‡å¤ªå¤šå°è‡´å®¹é‡å·²æ»¿ï¼Œè«‹å˜—è©¦ä¸åŠ ç…§ç‰‡ã€‚");
                return;
            }

            // Reset Form
            document.getElementById('item-name').value = "";
            document.getElementById('item-price').value = "";
            clearImage();
            
            renderExpenses();
        }

        function deleteExpense(id) {
            if(!confirm("ç¢ºå®šåˆªé™¤æ­¤ç­†ç´€éŒ„ï¼Ÿ")) return;
            let expenses = JSON.parse(localStorage.getItem('trip_expenses') || "[]");
            expenses = expenses.filter(e => e.id !== id);
            localStorage.setItem('trip_expenses', JSON.stringify(expenses));
            renderExpenses();
        }

        function renderExpenses() {
            const expenses = JSON.parse(localStorage.getItem('trip_expenses') || "[]");
            const rate = parseFloat(localStorage.getItem('trip_rate') || 0.22);
            const listEl = document.getElementById('expense-list');
            
            let totalJPY = 0;
            let html = "";

            expenses.forEach(ex => {
                totalJPY += ex.price;
                const twd = Math.round(ex.price * rate);
                
                html += `
                    <div class="card p-3 rounded-lg flex items-center justify-between animate-fade">
                        <div class="flex items-center space-x-3">
                            ${ex.img ? `<img src="${ex.img}" class="w-12 h-12 rounded object-cover border border-gray-600" onclick="alert('é è¦½åŠŸèƒ½ç°¡åŒ–ä¸­')">` : '<div class="w-12 h-12 bg-gray-800 rounded flex items-center justify-center text-gray-600"><i class="fas fa-receipt"></i></div>'}
                            <div>
                                <p class="text-white font-bold text-sm">${ex.name}</p>
                                <p class="text-xs text-gray-500">${ex.date}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <p class="text-gold-300 font-mono text-sm">Â¥${ex.price}</p>
                            <p class="text-gray-400 text-xs">â‰ˆ NT$${twd}</p>
                            <button onclick="deleteExpense(${ex.id})" class="text-red-900 text-[10px] mt-1">åˆªé™¤</button>
                        </div>
                    </div>
                `;
            });

            listEl.innerHTML = html || '<div class="text-center text-gray-600 text-sm mt-10">å°šç„¡è¨˜å¸³ç´€éŒ„</div>';
            
            document.getElementById('total-jpy').innerText = `Â¥ ${totalJPY.toLocaleString()}`;
            document.getElementById('total-twd').innerText = `NT$ ${Math.round(totalJPY * rate).toLocaleString()}`;
        }

        function loadWallet() {
            renderExpenses();
        }


        // --- Lists Logic ---
        const defaultChecklist = ["è­·ç…§", "ç¶²å¡ / ESIM", "å¡«å¯« Visit Japan Web", "è¡Œå‹•é›»æº", "å€‹äººè—¥å“", "ç¾é‡‘ / ä¿¡ç”¨å¡"];

        function loadChecklist() {
            let saved = JSON.parse(localStorage.getItem('trip_checklist') || "[]");
            if (saved.length === 0) {
                saved = defaultChecklist.map(item => ({ text: item, checked: false }));
            }
            renderChecklist(saved);
        }

        function toggleCheck(index) {
            let saved = JSON.parse(localStorage.getItem('trip_checklist'));
            saved[index].checked = !saved[index].checked;
            localStorage.setItem('trip_checklist', JSON.stringify(saved));
            renderChecklist(saved);
        }

        function renderChecklist(items) {
            const container = document.getElementById('checklist-container');
            let html = "";
            items.forEach((item, index) => {
                html += `
                    <li class="flex items-center justify-between p-3 bg-gray-900/50 rounded border border-gray-700 cursor-pointer ${item.checked ? 'opacity-50' : ''}" onclick="toggleCheck(${index})">
                        <span class="${item.checked ? 'line-through text-gray-500' : 'text-gray-200'}">${item.text}</span>
                        <i class="fas ${item.checked ? 'fa-check-circle text-gold-500' : 'fa-circle text-gray-700'}"></i>
                    </li>
                `;
            });
            container.innerHTML = html;
            // Also save initially if it was empty
            if(!localStorage.getItem('trip_checklist')) {
                 localStorage.setItem('trip_checklist', JSON.stringify(items));
            }
        }

        function loadMemo() {
            const text = localStorage.getItem('trip_memo') || "";
            document.getElementById('memo-area').value = text;
            extractLinks(text);
        }

        function saveMemo() {
            const text = document.getElementById('memo-area').value;
            localStorage.setItem('trip_memo', text);
            extractLinks(text);
        }

        function extractLinks(text) {
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const matches = text.match(urlRegex);
            const container = document.getElementById('memo-links');
            
            if (matches) {
                container.innerHTML = matches.map((url, i) => `
                    <a href="${url}" target="_blank" class="inline-flex items-center text-[10px] bg-gray-800 border border-gold-500/50 text-gold-300 px-2 py-1 rounded-full truncate max-w-full hover:bg-gold-500 hover:text-black transition">
                        <i class="fas fa-link mr-1"></i> é€£çµ ${i+1}
                    </a>
                `).join('');
            } else {
                container.innerHTML = "";
            }
        }

    </script>
</body>
</html>